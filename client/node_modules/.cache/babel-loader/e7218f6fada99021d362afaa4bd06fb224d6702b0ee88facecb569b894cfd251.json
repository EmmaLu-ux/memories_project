{"ast":null,"code":"import _regeneratorRuntime from\"/Users/emmalu/Documents/fronted/workspace/reactProjects/memories_project/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"/Users/emmalu/Documents/fronted/workspace/reactProjects/memories_project/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/emmalu/Documents/fronted/workspace/reactProjects/memories_project/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/emmalu/Documents/fronted/workspace/reactProjects/memories_project/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState}from'react';import{Card,CardActions,CardContent,CardMedia,Button,Typography,ButtonBase}from'@material-ui/core';import{ThumbUpAlt,Delete,MoreHoriz,ThumbUpAltOutlined}from'@material-ui/icons';import moment from'moment';import{useDispatch}from'react-redux';import{useNavigate}from'react-router-dom';import useStyles from'./styles';import{deletePost,likePost}from'../../../actions/posts';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Post=function Post(_ref){var _user$result,_user$result2,_user$result3,_user$result4,_user$result5,_user$result6;var post=_ref.post,setCurrentId=_ref.setCurrentId;var classes=useStyles();var dispatch=useDispatch();var user=JSON.parse(sessionStorage.getItem('profile'));var navigate=useNavigate();var _useState=useState(post===null||post===void 0?void 0:post.likes),_useState2=_slicedToArray(_useState,2),likes=_useState2[0],setLikes=_useState2[1];var userId=(user===null||user===void 0?void 0:(_user$result=user.result)===null||_user$result===void 0?void 0:_user$result.sub)||(user===null||user===void 0?void 0:(_user$result2=user.result)===null||_user$result2===void 0?void 0:_user$result2._id);var hasLikedPost=post.likes.find(function(like){return like===userId;});var handleLike=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:dispatch(likePost(post._id));if(hasLikedPost){// 已经点赞过了，再点就是取消点赞\nsetLikes(post.likes.filter(function(id){return id!==userId;}));}else{// 现在点赞，把该用户的id存进likes中\nsetLikes([].concat(_toConsumableArray(post.likes),[userId]));}case 2:case\"end\":return _context.stop();}},_callee);}));return function handleLike(){return _ref2.apply(this,arguments);};}();var Likes=function Likes(){if(likes.length>0){return likes.find(function(like){return like===userId;})?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ThumbUpAlt,{fontSize:\"small\"}),\"\\xA0\",likes.length>2?\"\\u60A8\\u548C\\u5176\\u4ED6\".concat(likes.length-1,\"\\u4EBA\"):\"\".concat(likes.length,\"\\u4EBA\\u559C\\u6B22\")]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ThumbUpAltOutlined,{fontSize:\"small\"}),\"\\xA0\",likes.length,\"\\u4EBA\\u559C\\u6B22\"]});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ThumbUpAltOutlined,{fontSize:\"small\"}),\"\\xA0\\u559C\\u6B22\"]});};var openPost=function openPost(){return navigate(\"/posts/\".concat(post._id));};return/*#__PURE__*/_jsxs(Card,{className:classes.card,raised:true,elevation:6,children:[/*#__PURE__*/_jsx(CardMedia,{component:\"div\",className:classes.media,image:post.selectedFile||'',title:post.title,onClick:openPost,style:{cursor:'pointer'}}),/*#__PURE__*/_jsxs(\"div\",{className:classes.overlay,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:post.name}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:moment(post.createdAt).fromNow()})]}),(user===null||user===void 0?void 0:(_user$result3=user.result)===null||_user$result3===void 0?void 0:_user$result3.sub)===(post===null||post===void 0?void 0:post.creator)||(user===null||user===void 0?void 0:(_user$result4=user.result)===null||_user$result4===void 0?void 0:_user$result4._id)===(post===null||post===void 0?void 0:post.creator)?/*#__PURE__*/_jsx(\"div\",{className:classes.overlay2,children:/*#__PURE__*/_jsx(Button,{style:{color:'white'},size:\"small\",onClick:function onClick(){return setCurrentId(post._id);},children:/*#__PURE__*/_jsx(MoreHoriz,{fontSize:\"medium\"})})}):null,/*#__PURE__*/_jsx(\"div\",{className:classes.details,children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",gutterBottom:true,children:post.tags.map(function(tag){return\"#\".concat(tag,\" \");})})}),/*#__PURE__*/_jsx(Typography,{className:classes.title,variant:\"h5\",gutterBottom:true,children:post.title}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",gutterBottom:true,children:post.message})}),/*#__PURE__*/_jsxs(CardActions,{className:classes.cardActions,children:[/*#__PURE__*/_jsx(Button,{size:\"small\",color:\"primary\",disabled:!(user!==null&&user!==void 0&&user.result),onClick:handleLike,children:/*#__PURE__*/_jsx(Likes,{})}),(user===null||user===void 0?void 0:(_user$result5=user.result)===null||_user$result5===void 0?void 0:_user$result5.sub)===(post===null||post===void 0?void 0:post.creator)||(user===null||user===void 0?void 0:(_user$result6=user.result)===null||_user$result6===void 0?void 0:_user$result6._id)===(post===null||post===void 0?void 0:post.creator)?/*#__PURE__*/_jsxs(Button,{size:\"small\",color:\"primary\",onClick:function onClick(){return dispatch(deletePost(post._id));},children:[/*#__PURE__*/_jsx(Delete,{fontSize:\"small\"}),\"\\u5220\\u9664\"]}):null]})]});};export default Post;","map":{"version":3,"names":["React","useState","Card","CardActions","CardContent","CardMedia","Button","Typography","ButtonBase","ThumbUpAlt","Delete","MoreHoriz","ThumbUpAltOutlined","moment","useDispatch","useNavigate","useStyles","deletePost","likePost","Post","post","setCurrentId","classes","dispatch","user","JSON","parse","sessionStorage","getItem","navigate","likes","setLikes","userId","result","sub","_id","hasLikedPost","find","like","handleLike","filter","id","Likes","length","openPost","card","media","selectedFile","title","cursor","overlay","name","createdAt","fromNow","creator","overlay2","color","details","tags","map","tag","message","cardActions"],"sources":["/Users/emmalu/Documents/fronted/workspace/reactProjects/memories_project/client/src/components/Posts/Post/Post.js"],"sourcesContent":["import React, { useState } from 'react'\nimport { Card, CardActions, CardContent, CardMedia, Button, Typography, ButtonBase } from '@material-ui/core'\nimport { ThumbUpAlt, Delete, MoreHoriz, ThumbUpAltOutlined } from '@material-ui/icons'\nimport moment from 'moment'\nimport { useDispatch } from 'react-redux'\nimport { useNavigate } from 'react-router-dom'\n\nimport useStyles from './styles'\nimport { deletePost, likePost } from '../../../actions/posts'\n\nconst Post = ({ post, setCurrentId }) => {\n  const classes = useStyles()\n  const dispatch = useDispatch()\n  const user = JSON.parse(sessionStorage.getItem('profile'))\n  const navigate = useNavigate()\n  const [likes, setLikes] = useState(post?.likes)\n  const userId = user?.result?.sub || user?.result?._id\n  const hasLikedPost = post.likes.find(like => like === userId)\n\n  const handleLike = async () => {\n    dispatch(likePost(post._id))\n    if(hasLikedPost){ // 已经点赞过了，再点就是取消点赞\n      setLikes(post.likes.filter(id => id !== userId))\n    }else{ // 现在点赞，把该用户的id存进likes中\n      setLikes([...post.likes, userId])\n    }\n  }\n  const Likes = () => {\n    if (likes.length > 0) {\n      return likes.find(like => like === userId)\n        ? (<><ThumbUpAlt fontSize=\"small\" />\n          &nbsp;{likes.length > 2 ? `您和其他${likes.length - 1}人` : `${likes.length}人喜欢`}</>\n        ) : (\n          <><ThumbUpAltOutlined fontSize=\"small\" />&nbsp;{likes.length}人喜欢</>\n        );\n    }\n    return <><ThumbUpAltOutlined fontSize=\"small\" />&nbsp;喜欢</>;\n  };\n\n  const openPost = () => navigate(`/posts/${post._id}`)\n  \n\n  return (\n    <Card className={classes.card} raised elevation={6}>\n      {/* <ButtonBase className={classes.cardAction} onClick={openPost}> */}\n        <CardMedia component='div' className={classes.media} image={post.selectedFile || ''} title={post.title} onClick={openPost} style={{ cursor: 'pointer'}}/>\n        <div className={classes.overlay}>\n          <Typography variant='h6'>{post.name}</Typography>\n          <Typography variant='body2'>{moment(post.createdAt).fromNow()}</Typography>\n        </div>\n        {(user?.result?.sub === post?.creator || user?.result?._id === post?.creator) ? (\n          <div className={classes.overlay2}>\n            <Button style={{ color: 'white' }} size='small'\n              onClick={() => setCurrentId(post._id)}>\n              <MoreHoriz fontSize='medium' />\n            </Button>\n          </div>\n        ) : null }\n\n        <div className={classes.details}>\n          <Typography variant='body2' color='textSecondary' gutterBottom>{post.tags.map(tag => `#${tag} `)}</Typography>\n        </div>\n        <Typography className={classes.title} variant='h5' gutterBottom>{post.title}</Typography>\n        <CardContent>\n          <Typography variant='body2' color='textSecondary' gutterBottom>{post.message}</Typography>\n        </CardContent>\n      {/* </ButtonBase> */}\n      <CardActions className={classes.cardActions}>\n        <Button size='small' color='primary'\n          disabled={!user?.result}\n          onClick={handleLike}>\n          {/* <ThumbUpAlt fontSize='small'/>\n          喜欢 &nbsp;\n          {post.likeCount} */}\n          <Likes />\n        </Button>\n        {(user?.result?.sub === post?.creator || user?.result?._id === post?.creator) ? (\n          <Button size='small' color='primary'\n            onClick={() => dispatch(deletePost(post._id))}>\n            <Delete fontSize='small' />\n            删除\n          </Button>\n        ) : null }\n      </CardActions>\n    </Card>\n  )\n}\n\nexport default Post"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}