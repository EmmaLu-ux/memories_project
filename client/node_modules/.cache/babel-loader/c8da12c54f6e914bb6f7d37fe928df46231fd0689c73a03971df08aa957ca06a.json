{"ast":null,"code":"import _slicedToArray from\"/Users/emmalu/Documents/fronted/workspace/reactProjects/memories_project/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import{Link}from'react-router-dom';import{AppBar,Typography,Toolbar,Avatar,Button}from'@material-ui/core';import{useDispatch}from'react-redux';import{useNavigate,useLocation}from'react-router-dom';import decode from'jwt-decode';import memoriesLogo from'../../images/memories-Logo.png';import memoriesText from'../../images/memories-Text.png';import useStyles from'./styles';import{LOGOUT}from'../../constants/actionTypes';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Navbar=function Navbar(){var _user$result,_user$result2,_user$result3,_user$result4;var classes=useStyles();var _useState=useState(JSON.parse(sessionStorage.getItem('profile'))),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];// console.log('user: ', user)\nvar dispatch=useDispatch();var navigate=useNavigate();var location=useLocation();var logout=function logout(){dispatch({type:LOGOUT});navigate('/',{replace:true});setUser(null);};useEffect(function(){var token=user===null||user===void 0?void 0:user.token;if(token){var decodeToken=decode(token);if(decodeToken.exp*1000<new Date().getTime())logout();}setUser(JSON.parse(sessionStorage.getItem('profile')));},[location]);return/*#__PURE__*/_jsxs(AppBar,{className:classes.appBar,position:\"static\",color:\"inherit\",children:[/*#__PURE__*/_jsxs(Link,{to:\"/\",className:classes.brandContainer,children:[/*#__PURE__*/_jsx(\"img\",{src:memoriesText,alt:\"icon\",height:\"45px\"}),/*#__PURE__*/_jsx(\"img\",{className:classes.image,src:memoriesLogo,alt:\"memories\",height:\"40px\"})]}),/*#__PURE__*/_jsx(Toolbar,{className:classes.toolbar,children:user?/*#__PURE__*/_jsxs(\"div\",{className:classes.profile,children:[/*#__PURE__*/_jsx(Avatar,{className:classes.purple,alt:user===null||user===void 0?void 0:(_user$result=user.result)===null||_user$result===void 0?void 0:_user$result.name,src:user===null||user===void 0?void 0:(_user$result2=user.result)===null||_user$result2===void 0?void 0:_user$result2.picture,children:user===null||user===void 0?void 0:(_user$result3=user.result)===null||_user$result3===void 0?void 0:_user$result3.name.charAt(0)}),/*#__PURE__*/_jsx(Typography,{className:classes.userName,variant:\"h6\",children:user===null||user===void 0?void 0:(_user$result4=user.result)===null||_user$result4===void 0?void 0:_user$result4.name}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",className:classes.logout,color:\"secondary\",onClick:logout,children:\"\\u9000\\u51FA\\u767B\\u5F55\"})]}):/*#__PURE__*/_jsx(Button,{component:Link,to:\"/auth\",variant:\"contained\",color:\"primary\",children:\"\\u767B\\u5F55\"})})]});};export default Navbar;","map":{"version":3,"names":["React","useEffect","useState","Link","AppBar","Typography","Toolbar","Avatar","Button","useDispatch","useNavigate","useLocation","decode","memoriesLogo","memoriesText","useStyles","LOGOUT","Navbar","classes","JSON","parse","sessionStorage","getItem","user","setUser","dispatch","navigate","location","logout","type","replace","token","decodeToken","exp","Date","getTime","appBar","brandContainer","image","toolbar","profile","purple","result","name","picture","charAt","userName"],"sources":["/Users/emmalu/Documents/fronted/workspace/reactProjects/memories_project/client/src/components/Navbar/Navbar.js"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { Link } from 'react-router-dom'\nimport { AppBar, Typography, Toolbar, Avatar, Button } from '@material-ui/core'\nimport { useDispatch } from 'react-redux'\nimport { useNavigate, useLocation } from 'react-router-dom'\nimport decode from 'jwt-decode'\n\nimport memoriesLogo from '../../images/memories-Logo.png'\nimport memoriesText from '../../images/memories-Text.png'\nimport useStyles from './styles'\nimport { LOGOUT } from '../../constants/actionTypes'\n\nconst Navbar = () => {\n    const classes = useStyles()\n    const [user, setUser] = useState(JSON.parse(sessionStorage.getItem('profile')))\n    // console.log('user: ', user)\n    const dispatch = useDispatch()\n    const navigate = useNavigate()\n    const location = useLocation()\n\n    const logout = () => {\n        dispatch({ type: LOGOUT })\n        navigate('/', { replace: true })\n        setUser(null)\n    }\n\n    useEffect(() => {\n        const token = user?.token\n        if(token){\n            const decodeToken = decode(token)\n            if(decodeToken.exp * 1000 < new Date().getTime()) logout()\n        }\n        setUser(JSON.parse(sessionStorage.getItem('profile')))\n    }, [location])\n    \n    return (\n        <AppBar className={classes.appBar} position='static' color='inherit'>\n            <Link to='/' className={classes.brandContainer}>\n                {/* <Typography component={Link} to='/' className={classes.heading} variant='h2' align='center'>Memories</Typography> */}\n                <img src={memoriesText} alt='icon' height='45px'/>\n                <img className={classes.image} src={memoriesLogo} alt='memories' height='40px' />\n            </Link>\n            <Toolbar className={classes.toolbar}>\n                {user ? (\n                    <div className={classes.profile}>\n                        <Avatar className={classes.purple} alt={user?.result?.name} src={user?.result?.picture}>{user?.result?.name.charAt(0)}</Avatar>\n                        <Typography className={classes.userName} variant='h6'>{user?.result?.name}</Typography>\n                        <Button variant='contained' className={classes.logout} color='secondary' onClick={logout}>退出登录</Button>\n                    </div>\n                ) : (\n                    <Button component={Link} to='/auth' variant='contained' color='primary'>登录</Button>\n                )}\n            </Toolbar>\n        </AppBar>\n    )\n}\n\nexport default Navbar"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}