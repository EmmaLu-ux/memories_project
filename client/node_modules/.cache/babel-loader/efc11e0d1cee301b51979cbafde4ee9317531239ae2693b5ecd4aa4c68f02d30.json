{"ast":null,"code":"import _regeneratorRuntime from\"/Users/emmalu/Documents/fronted/workspace/reactProjects/memories_project/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/emmalu/Documents/fronted/workspace/reactProjects/memories_project/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/emmalu/Documents/fronted/workspace/reactProjects/memories_project/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useRef}from\"react\";import{Button,Typography,TextField}from\"@material-ui/core\";import{useDispatch}from\"react-redux\";import useStyles from\"./styles\";import{commentPost}from'../../actions/posts';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CommentSection=function CommentSection(_ref){var _user$result2;var post=_ref.post;var classes=useStyles();var _useState=useState([post===null||post===void 0?void 0:post.comments]),_useState2=_slicedToArray(_useState,2),comments=_useState2[0],setComments=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),comment=_useState4[0],setComment=_useState4[1];//   console.log('post', post)\nvar dispatch=useDispatch();var user=JSON.parse(sessionStorage.getItem('profile'));var commentsRef=useRef();var handleClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _user$result;var finalComment,newComments;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:finalComment=\"\".concat(user===null||user===void 0?void 0:(_user$result=user.result)===null||_user$result===void 0?void 0:_user$result.name,\":\").concat(comment);_context.next=3;return dispatch(commentPost(finalComment,post._id));case 3:newComments=_context.sent;setComments(newComments);setComment('');commentsRef.current.scrollIntoView({behavior:'smooth'});case 7:case\"end\":return _context.stop();}},_callee);}));return function handleClick(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:classes.commentsOuterContainer,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.commentsInnerContainer,children:[/*#__PURE__*/_jsx(Typography,{gutterBottom:true,variant:\"h6\",children:\"\\u8BC4\\u8BBA\"}),comments.map(function(c,i){return/*#__PURE__*/_jsx(Typography,{gutterBottom:true,variant:\"subtitle1\",children:c},i);}),/*#__PURE__*/_jsx(\"div\",{ref:commentsRef})]}),(user===null||user===void 0?void 0:(_user$result2=user.result)===null||_user$result2===void 0?void 0:_user$result2.name)&&/*#__PURE__*/_jsxs(\"div\",{style:{width:\"70%\"},children:[/*#__PURE__*/_jsx(Typography,{gutterBottom:true,variant:\"h6\",children:\"\\u8BC4\\u8BBA:\"}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,maxRows:4,minRows:4,multiline:true,variant:\"outlined\",label:\"\\u8BC4\\u8BBA\",value:comment,onChange:function onChange(e){return setComment(e.target.value);}}),/*#__PURE__*/_jsx(Button,{style:{marginTop:\"10px\"},fullWidth:true,disabled:!comment,variant:\"contained\",color:\"primary\",onClick:handleClick,children:\"\\u53D1\\u5E03\\u8BC4\\u8BBA\"})]})]})});};export default CommentSection;","map":{"version":3,"names":["React","useState","useRef","Button","Typography","TextField","useDispatch","useStyles","commentPost","CommentSection","post","classes","comments","setComments","comment","setComment","dispatch","user","JSON","parse","sessionStorage","getItem","commentsRef","handleClick","finalComment","result","name","_id","newComments","current","scrollIntoView","behavior","commentsOuterContainer","commentsInnerContainer","map","c","i","width","e","target","value","marginTop"],"sources":["/Users/emmalu/Documents/fronted/workspace/reactProjects/memories_project/client/src/components/PostDetails/CommentSection.jsx"],"sourcesContent":["import React, { useState, useRef } from \"react\";\nimport { Button, Typography, TextField } from \"@material-ui/core\";\nimport { useDispatch } from \"react-redux\";\n\nimport useStyles from \"./styles\";\nimport { commentPost } from '../../actions/posts'\n\nconst CommentSection = ({ post }) => {\n  const classes = useStyles();\n  const [comments, setComments] = useState([post?.comments]);\n  const [comment, setComment] = useState(\"\");\n  //   console.log('post', post)\n  const dispatch = useDispatch()\n  const user = JSON.parse(sessionStorage.getItem('profile'))\n  const commentsRef = useRef()\n\n  const handleClick = async () => {\n    const finalComment = `${user?.result?.name}:${comment}`\n    const newComments = await dispatch(commentPost(finalComment, post._id))\n    setComments(newComments)\n    setComment('')\n    commentsRef.current.scrollIntoView({ behavior: 'smooth' })\n  };\n  return (\n    <div>\n      <div className={classes.commentsOuterContainer}>\n        <div className={classes.commentsInnerContainer}>\n          <Typography gutterBottom variant=\"h6\">评论</Typography>\n          {comments.map((c, i) => (\n            <Typography key={i} gutterBottom variant=\"subtitle1\">\n              {c}\n              {/* <strong>{c.split(': ')[0]}</strong>\n              {c.split(':')[1]} */}\n            </Typography>\n          ))}\n          <div ref={commentsRef} />\n        </div>\n        {user?.result?.name && (\n          <div style={{ width: \"70%\" }}>\n            <Typography gutterBottom variant=\"h6\">评论:</Typography>\n            <TextField\n              fullWidth\n              maxRows={4}\n              minRows={4}\n              multiline\n              variant=\"outlined\"\n              label=\"评论\"\n              value={comment}\n              onChange={(e) => setComment(e.target.value)}\n            />\n            <Button\n              style={{ marginTop: \"10px\" }}\n              fullWidth\n              disabled={!comment}\n              variant=\"contained\"\n              color=\"primary\"\n              onClick={handleClick}\n            >发布评论</Button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CommentSection;\n"],"mappings":"+fAAA,MAAOA,MAAK,EAAIC,QAAQ,CAAEC,MAAM,KAAQ,OAAO,CAC/C,OAASC,MAAM,CAAEC,UAAU,CAAEC,SAAS,KAAQ,mBAAmB,CACjE,OAASC,WAAW,KAAQ,aAAa,CAEzC,MAAOC,UAAS,KAAM,UAAU,CAChC,OAASC,WAAW,KAAQ,qBAAqB,yFAEjD,GAAMC,eAAc,CAAG,QAAjBA,eAAc,MAAiB,sBAAXC,KAAI,MAAJA,IAAI,CAC5B,GAAMC,QAAO,CAAGJ,SAAS,EAAE,CAC3B,cAAgCN,QAAQ,CAAC,CAACS,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEE,QAAQ,CAAC,CAAC,wCAAnDA,QAAQ,eAAEC,WAAW,eAC5B,eAA8BZ,QAAQ,CAAC,EAAE,CAAC,yCAAnCa,OAAO,eAAEC,UAAU,eAC1B;AACA,GAAMC,SAAQ,CAAGV,WAAW,EAAE,CAC9B,GAAMW,KAAI,CAAGC,IAAI,CAACC,KAAK,CAACC,cAAc,CAACC,OAAO,CAAC,SAAS,CAAC,CAAC,CAC1D,GAAMC,YAAW,CAAGpB,MAAM,EAAE,CAE5B,GAAMqB,YAAW,6FAAG,kLACZC,YAAY,WAAMP,IAAI,SAAJA,IAAI,+BAAJA,IAAI,CAAEQ,MAAM,uCAAZ,aAAcC,IAAI,aAAIZ,OAAO,wBAC3BE,SAAQ,CAACR,WAAW,CAACgB,YAAY,CAAEd,IAAI,CAACiB,GAAG,CAAC,CAAC,QAAjEC,WAAW,eACjBf,WAAW,CAACe,WAAW,CAAC,CACxBb,UAAU,CAAC,EAAE,CAAC,CACdO,WAAW,CAACO,OAAO,CAACC,cAAc,CAAC,CAAEC,QAAQ,CAAE,QAAS,CAAC,CAAC,sDAC3D,kBANKR,YAAW,2CAMhB,CACD,mBACE,kCACE,aAAK,SAAS,CAAEZ,OAAO,CAACqB,sBAAuB,wBAC7C,aAAK,SAAS,CAAErB,OAAO,CAACsB,sBAAuB,wBAC7C,KAAC,UAAU,EAAC,YAAY,MAAC,OAAO,CAAC,IAAI,UAAC,cAAE,EAAa,CACpDrB,QAAQ,CAACsB,GAAG,CAAC,SAACC,CAAC,CAAEC,CAAC,qBACjB,KAAC,UAAU,EAAS,YAAY,MAAC,OAAO,CAAC,WAAW,UACjDD,CAAC,EADaC,CAAC,CAIL,EACd,CAAC,cACF,YAAK,GAAG,CAAEd,WAAY,EAAG,GACrB,CACL,CAAAL,IAAI,SAAJA,IAAI,gCAAJA,IAAI,CAAEQ,MAAM,wCAAZ,cAAcC,IAAI,gBACjB,aAAK,KAAK,CAAE,CAAEW,KAAK,CAAE,KAAM,CAAE,wBAC3B,KAAC,UAAU,EAAC,YAAY,MAAC,OAAO,CAAC,IAAI,UAAC,eAAG,EAAa,cACtD,KAAC,SAAS,EACR,SAAS,MACT,OAAO,CAAE,CAAE,CACX,OAAO,CAAE,CAAE,CACX,SAAS,MACT,OAAO,CAAC,UAAU,CAClB,KAAK,CAAC,cAAI,CACV,KAAK,CAAEvB,OAAQ,CACf,QAAQ,CAAE,kBAACwB,CAAC,QAAKvB,WAAU,CAACuB,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC,EAAC,EAC5C,cACF,KAAC,MAAM,EACL,KAAK,CAAE,CAAEC,SAAS,CAAE,MAAO,CAAE,CAC7B,SAAS,MACT,QAAQ,CAAE,CAAC3B,OAAQ,CACnB,OAAO,CAAC,WAAW,CACnB,KAAK,CAAC,SAAS,CACf,OAAO,CAAES,WAAY,UACtB,0BAAI,EAAS,GAEjB,GACG,EACF,CAEV,CAAC,CAED,cAAed,eAAc"},"metadata":{},"sourceType":"module","externalDependencies":[]}